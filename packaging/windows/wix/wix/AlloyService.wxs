<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
	<?define ComponentRules="OneToOne"?>
	<?define ServiceSourceDir="..\..\..\..\dist.temp"?>
	<Fragment>
		<ComponentGroup Id="AlloyService">
			<Component Directory="INSTALLLOCATION">
				<File Source="$(var.ServiceSourceDir)\alloy-service-windows-amd64.exe" />

				<ServiceInstall
					Id="ServiceInstall"
					Account="LocalSystem"
					ErrorControl="normal"
					Name="Alloy"
					Start="auto"
					Type="ownProcess"
					Vital="yes"
					Description="Alloy by Grafana Labs"
					DisplayName="Alloy">
					<ServiceConfig OnInstall="yes" OnReinstall="yes" DelayedAutoStart="yes" />
				</ServiceInstall>

				<ServiceControl
					Id="ServiceControl_Start"
					Name="Alloy"
					Start="install"
					Wait="no"
			  />

				<ServiceControl
					Id="ServiceControl_Stop"
					Name="Alloy"
					Stop="both"
					Remove="uninstall"
					Wait="yes"
				/>
			</Component>
		</ComponentGroup>
	</Fragment>
</Wix>